<!DOCTYPE html> <!-- HTML5 ã§ã‚ã‚‹ã“ã¨ã‚’å®£è¨€ -->
<html>
<head>
  <meta charset="UTF-8"> <!-- æ—¥æœ¬èªãªã©ã‚’æ­£ã—ãè¡¨ç¤ºã™ã‚‹ãŸã‚ã®æ–‡å­—ã‚³ãƒ¼ãƒ‰è¨­å®š -->
  <title>World City Weather Viewer</title> <!-- ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¿ãƒ–ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚¿ã‚¤ãƒˆãƒ« -->

  <!-- Leaflet ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆï¼ˆåœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«å¿…è¦ï¼‰ -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  
  <!-- Leaflet ã®JavaScriptæœ¬ä½“ï¼ˆåœ°å›³ã®è¡¨ç¤ºãƒ»æ“ä½œã®ãŸã‚ï¼‰ -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <!-- ãƒšãƒ¼ã‚¸å…¨ä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«è¨­å®š -->
  <style>
    body { font-family: Arial, sans-serif; padding: 10px; } /* å…¨ä½“ã®ãƒ•ã‚©ãƒ³ãƒˆã¨ä½™ç™½ */
    #map { height: 400px; width: 100%; margin-bottom: 10px; } /* åœ°å›³ã®ã‚µã‚¤ã‚ºæŒ‡å®š */
    label { font-weight: bold; } /* ãƒ©ãƒ™ãƒ«æ–‡å­—ã‚’å¤ªå­—ã« */
    pre { background: #f5f5f5; padding: 10px; } /* çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ã®èƒŒæ™¯ãƒ»ä½™ç™½ */
  </style>
</head>

<body>

<h1>ğŸŒ Select a City on the Map</h1> <!-- ãƒšãƒ¼ã‚¸ã®è¦‹å‡ºã— -->

<!-- åœ°å›³ã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
<div id="map"></div>

<!-- æ—¥ä»˜ã‚’é¸æŠã™ã‚‹å…¥åŠ›æ¬„ -->
<label for="date">Select Date:</label>
<input type="date" id="date"><br><br>

<!-- å¤©æ°—ã®çµæœã‚’è¡¨ç¤ºã™ã‚‹ã‚¨ãƒªã‚¢ -->
<pre id="result">Click a city pin on the map after selecting a date.</pre>

<script>
  // ä¸–ç•Œã®ä¸»è¦20éƒ½å¸‚ã‚’ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§å®šç¾©ï¼ˆéƒ½å¸‚åã€ç·¯åº¦ã€çµŒåº¦ï¼‰
  const cityCoords = {
    tokyo:       { name: "Tokyo",       lat: 35.6895, lon: 139.6917 },
    newyork:     { name: "New York",    lat: 40.7128, lon: -74.0060 },
    london:      { name: "London",      lat: 51.5074, lon: -0.1278 },
    paris:       { name: "Paris",       lat: 48.8566, lon: 2.3522 },
    sydney:      { name: "Sydney",      lat: -33.8688, lon: 151.2093 },
    delhi:       { name: "Delhi",       lat: 28.6139, lon: 77.2090 },
    cairo:       { name: "Cairo",       lat: 30.0444, lon: 31.2357 },
    bangkok:     { name: "Bangkok",     lat: 13.7563, lon: 100.5018 },
    rio:         { name: "Rio de Janeiro", lat: -22.9068, lon: -43.1729 },
    moscow:      { name: "Moscow",      lat: 55.7558, lon: 37.6173 },
    nairobi:     { name: "Nairobi",     lat: -1.2921, lon: 36.8219 },
    toronto:     { name: "Toronto",     lat: 43.6511, lon: -79.3470 },
    seoul:       { name: "Seoul",       lat: 37.5665, lon: 126.9780 },
    singapore:   { name: "Singapore",   lat: 1.3521, lon: 103.8198 },
    berlin:      { name: "Berlin",      lat: 52.5200, lon: 13.4050 },
    beijing:     { name: "Beijing",     lat: 39.9042, lon: 116.4074 },
    istanbul:    { name: "Istanbul",    lat: 41.0082, lon: 28.9784 },
    buenos:      { name: "Buenos Aires", lat: -34.6037, lon: -58.3816 },
    johannes:    { name: "Johannesburg", lat: -26.2041, lon: 28.0473 },
    losangeles:  { name: "Los Angeles", lat: 34.0522, lon: -118.2437 }
  };

  // åœ°å›³ã‚’åˆæœŸåŒ–ï¼ˆä¸­å¿ƒä½ç½®ï¼šç·¯åº¦20 çµŒåº¦0ã€ã‚ºãƒ¼ãƒ ãƒ¬ãƒ™ãƒ«2ï¼‰
  const map = L.map('map').setView([20, 0], 2);

  // ã‚¿ã‚¤ãƒ«ï¼ˆèƒŒæ™¯åœ°å›³ï¼‰ã‚’OpenStreetMapã‹ã‚‰èª­ã¿è¾¼ã‚€
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors' // è‘—ä½œæ¨©è¡¨è¨˜
  }).addTo(map);

  // å„éƒ½å¸‚ã«ãƒ”ãƒ³ï¼ˆãƒãƒ¼ã‚«ãƒ¼ï¼‰ã‚’ç«‹ã¦ã¦ã€ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’è¨­å®š
  Object.values(cityCoords).forEach(city => {
    const marker = L.marker([city.lat, city.lon]).addTo(map); // ãƒ”ãƒ³ã®è¨­ç½®
    marker.bindPopup(city.name); // éƒ½å¸‚åã®ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—
    marker.on("click", () => getWeather(city)); // ã‚¯ãƒªãƒƒã‚¯æ™‚ã«å¤©æ°—å–å¾—
  });

  // å¤©æ°—ã‚’å–å¾—ã—ã¦è¡¨ç¤ºã™ã‚‹é–¢æ•°
  async function getWeather(city) {
    const date = document.getElementById("date").value; // é¸æŠã•ã‚ŒãŸæ—¥ä»˜ã‚’å–å¾—

    if (!date) {
      alert("ğŸ“… Please select a date first."); // æ—¥ä»˜ãŒæœªé¸æŠãªã‚‰è­¦å‘Š
      return;
    }

    // Open-Meteo ã®éå»å¤©æ°—APIã®URLã‚’çµ„ã¿ç«‹ã¦ã‚‹
    const url = `https://archive-api.open-meteo.com/v1/archive?latitude=${city.lat}&longitude=${city.lon}&daily=temperature_2m_min,temperature_2m_max&timezone=Asia/Tokyo&start_date=${date}&end_date=${date}`;

    try {
      const res = await fetch(url);         // APIã‚’å‘¼ã³å‡ºã™
      const data = await res.json();        // JSONå½¢å¼ã§çµæœã‚’å—ã‘å–ã‚‹

      const min = data.daily?.temperature_2m_min?.[0]; // æœ€ä½æ°—æ¸©
      const max = data.daily?.temperature_2m_max?.[0]; // æœ€é«˜æ°—æ¸©

      // ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã®å‡¦ç†
      if (min == null || max == null) {
        document.getElementById("result").textContent =
          `âš ï¸ No data found for ${city.name} on ${date}`;
      } else {
        // çµæœã‚’è¡¨ç¤ºæ¬„ã«å‡ºåŠ›
        document.getElementById("result").textContent =
          `ğŸ“ ${city.name} (${date})\nğŸŒ¡ï¸ Min: ${min}Â°C, Max: ${max}Â°C`;
      }
    } catch (err) {
      // ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ãªã©ãŒèµ·ããŸå ´åˆã®å‡¦ç†
      document.getElementById("result").textContent = `ğŸš« Error: ${err.message}`;
    }
  }
</script>

</body>
</html>
